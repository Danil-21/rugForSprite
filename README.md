## RAG-движок для AI-агента поддержки (MVP)

Этот проект реализует простой RAG-сервис (Python + FastAPI), который:

- индексирует текстовые файлы (инструкции, регламенты, FAQ),
- по вопросу пользователя ищет релевантные фрагменты,
- формирует ответ с помощью локальной LLM (через Ollama) и эмбеддингов HuggingFace, опираясь на найденный контекст.

Этот сервис можно встроить в Telegram-бота как отдельный backend.

---

## 1. Подготовка окружения

- **Установи Python 3.10+** (проверь командой `python --version` или `py --version`).
- В корне проекта выполни в PowerShell:

```powershell
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

### Установка Ollama (локальная LLM, без ключей)

1. Зайди на сайт Ollama (`https://ollama.com`) и скачай установщик для Windows.
2. Установи Ollama и перезагрузи PowerShell / терминал.
3. В PowerShell скачай модель (пример – лёгкая `llama3.2`):

```powershell
ollama pull llama3.2
```

После этого Ollama будет слушать на `http://127.0.0.1:11434`, а FastAPI-приложение сможет звать локальную модель без каких-либо API-ключей.

---

## 2. Подготовка данных (документов)

1. Создай папку `data/raw`, если она ещё не создана:

```powershell
mkdir data
mkdir data\raw
```

2. Собери материалы с сайта Сбера и внутренних ресурсов:
   - регламенты работы линий поддержки,
   - описания внутренних сервисов,
   - типовые проблемы и решения,
   - FAQ.

3. Преобразуй их в `.txt` (один файл = один документ) и положи в `data/raw`.
   - Кодировка: **UTF-8**.
   - Можно вручную копировать нужный текст со страниц сайта в `.txt`.

---

## 3. Построение индекса (один раз, либо при обновлении данных)

В активированном виртуальном окружении запусти:

```powershell
python build_index.py
```

Скрипт:
- прочитает все `.txt` из `data/raw`,
- разобьёт их на фрагменты,
- создаст векторный индекс в `data/chroma_db`.

Если данных нет, скрипт просто напишет, что в `data/raw` нет файлов.

---

## 4. Запуск RAG-API

Запусти FastAPI-приложение:

```powershell
uvicorn app:app --reload
```

По умолчанию сервер будет доступен по адресу:

- `http://127.0.0.1:8000`
- Swagger UI (документация) – `http://127.0.0.1:8000/docs`

---

## 5. Пример запроса к RAG-эндпоинту

Эндпоинт: `POST /ask`  
Тело запроса (JSON):

```json
{
  "question": "Что делать, если сотруднику не приходит SMS-код для входа во внутренний сервис?"
}
```

Пример через PowerShell:

```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:8000/ask" -Method POST -ContentType "application/json" -Body '{\"question\": \"Как восстановить доступ к внутреннему порталу?\"}'
```

На выходе ты получишь JSON с:
- `answer` – текст ответа,
- `sources` – список фрагментов документов, на которых основан ответ.

---

## 6. Встраивание в Telegram-бота (кратко)

Для команды/сообщения пользователя в боте backend должен:

1. Отправить запрос к этому сервису на `POST /ask` с JSON `{"question": "<текст пользователя>"}`.
2. Забрать поле `answer` из ответа.
3. Отправить этот текст в Telegram как ответ пользователю.

Всё остальное (эмбеддинги, выбор документов, логика RAG) уже скрыто внутри этого сервиса.


